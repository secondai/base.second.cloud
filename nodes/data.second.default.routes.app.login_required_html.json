{
  "name": "base.second.cloud.data.second.default.routes.app.login_required_html",
  "type": "types.second.default.code.html",
  "data": {
    "html": "<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Second Login</title>\n    <script src=\"https://unpkg.com/react@16/umd/react.development.js\"></script>\n    <script src=\"https://unpkg.com/react-dom@16/umd/react-dom.development.js\"></script>\n    \n    <!-- Don't use this in production: -->\n    <script src=\"https://unpkg.com/babel-standalone@6.15.0/babel.min.js\"></script>\n    \n    <style>\n      .nodisplay {\n        display: none;\n      }\n    </style>\n    \n  </head>\n  <body>\n    <div id=\"root\"></div>\n    <script type=\"text/babel\">\n      \n      // require a login page (stored in session/cookie) \n      // if logged in, show the button to grant a new token \n      \n      // post login to session, reload page \n      \n      class App extends React.Component {\n        constructor(props){\n          super(props);\n          this.state = {}\n        }\n        render() { \n          return (\n            <div>\n              <h1 className=\"title is-3\">Login Required</h1>\n              <h3 className=\"subtitle is-5\">Before using apps</h3>\n              <Login />\n            </div>\n          ); \n        } \n      }\n      \n      class Login extends React.Component {\n        constructor(props){\n          super(props);\n          this.state = {\n            passphrase: ''\n          }\n        }\n        handleSubmit = async ()=>{\n          console.log('Trying login using passphrase');\n          \n          let { passphrase } = this.state;\n          \n          const rawResponse = await fetch('/auth/login', {\n            method: 'POST',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({passphrase})\n          });\n          const content = await rawResponse.json();\n  \n          console.log('Login response:', content);\n          if(content){\n            window.location.reload();\n          } else {\n            console.log('Not logged in');\n            window.alert('Invalid passphrase');\n          }\n          \n          return false;\n        }\n        render(){\n          return (\n            <div>\n              <input \n                type=\"text\" \n                placeholder=\"passphrase\"\n                onChange={e=>this.setState({passphrase:e.target.value})}\n                value={this.state.passphrase}\n              />\n              <button onClick={this.handleSubmit}>\n                Login\n              </button>\n            </div>\n          )\n        }\n        \n      }\n      \n      \n      ReactDOM.render(\n        <App />,\n        document.getElementById('root')\n      );\n\n    </script>\n    \n    \n  </body>\n</html>"
  },
  "blobdata": null,
  "createdAt": "2019-03-27T08:23:11.588Z",
  "updatedAt": "2019-04-03T21:34:53.063Z",
  "nodes": []
}